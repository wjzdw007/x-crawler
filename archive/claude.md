# Claude Code 工作原则

## 核心开发原则

### 1. 严格的分析方法论
**认真分析，大胆假设，小心验证**

- ❌ **绝对不允许**：基于猜测编写代码
- ❌ **绝对不允许**：想当然地处理问题
- ✅ **必须做到**：一切基于实际的代码/数据/请求
- ✅ **必须做到**：系统化验证每个假设

### 2. 环境和依赖管理
- ⚠️ **重要提醒**：使用Python脚本时记得激活虚拟环境
- 🎯 **目标**：避免重复登录，保持开发状态

### 3. 问题导向的开发
**已知核心问题**：
1. 帖子内容不完整（新发现的关键问题）
2. 转帖的原帖获取不到
3. 嵌套转帖的复杂情况
4. 图片视频地址获取失败
5. 数据错误和不完整

### 4. 防止"越改越差"的版本管理
- 🔄 **自动版本标记**：记录每个版本的性能指标
- 📊 **性能监控**：实时对比新旧版本效果
- 🚨 **自动回退**：性能下降>10%时自动回退
- 📈 **渐进改进**：小步快跑，每次只改一个功能

### 5. 测试驱动的开发
- 📚 **黄金数据集**：建立已知正确内容的测试数据
- 🔍 **自动化测试**：每次修改后自动验证数据质量
- 🛠️ **智能修复**：LLM辅助错误分析和修复建议
- 📋 **A/B测试**：新旧版本并行运行对比

## 项目特定原则

### API分析阶段
1. **两阶段开发**：先用Playwright分析，后用纯HTTP实现
2. **深度分析**：重点研究数据结构和字段完整性
3. **实际验证**：对比浏览器显示vs API返回的差异
4. **系统记录**：保存所有请求响应用于后续分析

### 数据完整性验证
- 📝 **文本完整性**：验证`text` vs `full_text`字段
- 🔄 **转推结构**：深入分析转推和嵌套转推的数据路径
- 🖼️ **媒体文件**：确保图片视频URL的正确提取
- 📊 **统计监控**：建立数据质量指标和监控

### 技术选型原则
- 🐍 **Python**: 主要开发语言
- 🎭 **Playwright**: 仅用于分析阶段
- 📡 **requests**: 生产环境HTTP客户端
- 📁 **JSON**: 简化数据存储方案
- 🤖 **LLM**: 内容总结和错误分析

### JSON数据结构分析最佳实践
- 🔍 **Claude Code擅长JSON分析**: 复杂JSON结构分析时，提取JSON片段给Claude Code分析
- 📊 **结构化输出**: Claude Code能快速识别嵌套结构、字段类型和数据路径
- 🚀 **效率优化**: 避免人工逐层解析，直接让AI分析复杂数据结构
- 📝 **使用方法**: 
  ```bash
  # 提取JSON片段
  cat response.json | jq '.data.complex_structure' > structure.json
  # 然后将structure.json内容提供给Claude Code分析
  ```

### 新功能开发标准流程
#### Phase 1: 代码Review和架构分析 (必须第一步)
- 🔍 **核心模块分析**: 理解crawler.py、validator.py、generator.py的设计模式
- 📊 **数据流追踪**: 从API响应到最终报告的完整数据处理链路
- ⚙️ **配置机制**: 掌握config.json和CLI参数的集成方式
- 🔌 **扩展点识别**: 发现最佳的功能集成位置和模式

#### Phase 2: 现有数据分析
- 🎯 **数据优先原则**: 分析项目中已有的真实数据（API响应、推文数据等）
- 📈 **模式发现**: 基于现有数据识别待解决问题的特征
- 🔍 **字段探索**: 利用Claude Code的JSON分析能力深度分析数据结构

#### Phase 3: 设计和实现
- 💡 **架构一致性**: 确保新功能符合现有代码风格和设计模式
- 🔄 **分析-假设-验证循环**: 数据分析 → 模式发现 → 假设提出 → 验证实现
- 🧪 **渐进式开发**: 小步迭代，每步都基于实际数据验证

#### ⚠️ 严格禁止的做法
- 跳过代码review直接开发新功能
- 在没有分析现有数据的情况下搜索外部文档  
- 基于理论而非实际数据编写代码
- 忽略现有架构模式自立门户

## 工作流程原则

### 开发流程
1. **需求分析** → 明确问题和目标
2. **环境设置** → 虚拟环境和依赖管理
3. **深度分析** → 基于实际数据的API分析
4. **验证实现** → 系统化验证每个功能
5. **测试优化** → 持续监控和改进

### 质量保证
- 🎯 **问题导向**：优先解决已知的核心问题
- 🔬 **数据驱动**：基于实际数据做决策
- 📈 **持续改进**：建立反馈循环和优化机制
- 🛡️ **稳定优先**：确保系统稳定性，防止越改越差

### 文档和知识管理
- 📚 **完整文档**：设计方案、分析结果、讨论记录
- 🔄 **持续更新**：及时记录新发现和解决方案
- 🎯 **问题追踪**：系统化记录和跟踪问题状态
- 💡 **经验总结**：提炼可复用的方法和工具

## 提醒和注意事项

### 开发过程中
- ⚠️ 激活虚拟环境：`source venv/bin/activate`
- 📊 使用TodoWrite工具跟踪任务进度
- 🔍 每个假设都要通过实际数据验证
- 📝 及时更新文档和分析结果

### 测试和验证
- 🧪 建立完整的测试用例
- 📈 设置性能基准和监控指标
- 🚨 实现自动告警和回退机制
- 🔄 定期对比不同版本的效果

### 长期维护
- 📊 定期分析数据质量报告
- 🔧 持续优化解析逻辑
- 📚 更新文档和知识库
- 🎯 根据新问题调整优先级

---

**记住**：这个项目的成功关键在于解决实际问题，而不是实现功能。每一行代码都应该基于真实的数据分析结果。