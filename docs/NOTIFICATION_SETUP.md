# é€šçŸ¥é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•é…ç½®å„ç§å¤±è´¥é€šçŸ¥æ–¹æ¡ˆã€‚

---

## ğŸ¯ æ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | æˆæœ¬ | å®æ—¶æ€§ | æ¨èåº¦ |
|-----|------|------|--------|--------|
| **GitHub Issue** | â­ æœ€ç®€å• | å…è´¹ | å³æ—¶ | â­â­â­â­ |
| **GitHub Email** | â­ æ— éœ€é…ç½® | å…è´¹ | å»¶è¿Ÿ | â­â­â­ |
| **Telegram** | â­â­ ç®€å• | å…è´¹ | å³æ—¶ | â­â­â­â­â­ |
| **Bark (iOS)** | â­â­ ç®€å• | å…è´¹ | å³æ—¶ | â­â­â­â­ |
| **ä¼ä¸šå¾®ä¿¡** | â­â­ ä¸­ç­‰ | å…è´¹ | å³æ—¶ | â­â­â­â­ |
| **é’‰é’‰** | â­â­ ä¸­ç­‰ | å…è´¹ | å³æ—¶ | â­â­â­â­ |
| **Discord** | â­â­ ç®€å• | å…è´¹ | å³æ—¶ | â­â­â­ |
| **Slack** | â­â­â­ å¤æ‚ | æ”¶è´¹ | å³æ—¶ | â­â­ |

---

## æ–¹æ¡ˆ 1: GitHub Issue (å·²å†…ç½®ï¼Œæ— éœ€é…ç½®) â­â­â­â­

### ä¼˜åŠ¿
- âœ… **æ— éœ€ä»»ä½•é…ç½®**ï¼Œå¼€ç®±å³ç”¨
- âœ… è‡ªåŠ¨åˆ›å»º Issueï¼Œä¾¿äºè·Ÿè¸ªé—®é¢˜
- âœ… åŒ…å«è¯¦ç»†çš„è¿è¡Œä¿¡æ¯å’Œå¿«é€Ÿé“¾æ¥
- âœ… å¯ä»¥ç›´æ¥åœ¨ Issue ä¸­è®¨è®ºå’Œæ ‡è®°å®Œæˆ

### ä½¿ç”¨æ–¹å¼
å·²ç»é›†æˆåœ¨ `daily-crawler.yml` ä¸­ï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚

å¤±è´¥æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Issueï¼ŒåŒ…å«ï¼š
- ğŸ“… å¤±è´¥æ—¶é—´
- ğŸ”— è¿è¡Œæ—¥å¿—é“¾æ¥
- âœ… å¸¸è§é—®é¢˜æ£€æŸ¥æ¸…å•
- ğŸ·ï¸ è‡ªåŠ¨æ‰“ä¸Š `bot`ã€`crawler-failure` æ ‡ç­¾

### æŸ¥çœ‹é€šçŸ¥
è®¿é—®ä»“åº“çš„ `Issues` æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹è‡ªåŠ¨åˆ›å»ºçš„å¤±è´¥æŠ¥å‘Šã€‚

### å…³é—­ Issue
é—®é¢˜è§£å†³åæ‰‹åŠ¨å…³é—­ Issue å³å¯ã€‚

---

## æ–¹æ¡ˆ 2: GitHub Email é€šçŸ¥ (é»˜è®¤å¯ç”¨) â­â­â­

### ä¼˜åŠ¿
- âœ… å®Œå…¨å…è´¹ï¼Œæ— éœ€é…ç½®
- âœ… GitHub é»˜è®¤åŠŸèƒ½

### é…ç½®æ–¹å¼

1. **æ£€æŸ¥é‚®ç®±è®¾ç½®**
   - è¿›å…¥ GitHub ä¸ªäºº Settings â†’ Notifications
   - ç¡®ä¿å‹¾é€‰äº† Actions ç›¸å…³é€šçŸ¥

2. **è‡ªå®šä¹‰é€šçŸ¥è§„åˆ™**
   ```
   Settings â†’ Notifications â†’ Actions
   â†’ âœ… Send notifications for failed workflows
   â†’ âœ… Only notify for workflows I subscribe to (å¯é€‰)
   ```

3. **é’ˆå¯¹ç‰¹å®šä»“åº“é…ç½®**
   ```
   ä»“åº“é¡µé¢ â†’ Watch â†’ Custom
   â†’ âœ… Issues
   â†’ âœ… Actions (workflows)
   ```

### ç¼ºç‚¹
- âš ï¸ å¯èƒ½æœ‰å»¶è¿Ÿ
- âš ï¸ å®¹æ˜“è¢«æ·¹æ²¡åœ¨å…¶ä»–é‚®ä»¶ä¸­

---

## æ–¹æ¡ˆ 3: Telegram Bot (å¼ºçƒˆæ¨è) â­â­â­â­â­

### ä¼˜åŠ¿
- âœ… å®Œå…¨å…è´¹
- âœ… æ¨é€åŠæ—¶ï¼ˆç§’çº§ï¼‰
- âœ… æ”¯æŒ Markdown æ ¼å¼
- âœ… è·¨å¹³å°ï¼ˆiOS/Android/æ¡Œé¢ï¼‰

### é…ç½®æ­¥éª¤

#### 1. åˆ›å»º Telegram Bot

1. åœ¨ Telegram ä¸­æœç´¢ `@BotFather`
2. å‘é€ `/newbot` å‘½ä»¤
3. æŒ‰æç¤ºè®¾ç½® Bot åç§°å’Œç”¨æˆ·å
4. è·å– **Bot Token**ï¼ˆå½¢å¦‚ `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`ï¼‰

#### 2. è·å– Chat ID

**æ–¹æ³• A: ä½¿ç”¨ç°æœ‰ Bot**
1. å‘ä½ çš„ Bot å‘é€ä»»æ„æ¶ˆæ¯
2. è®¿é—®: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. åœ¨è¿”å›çš„ JSON ä¸­æ‰¾åˆ° `chat.id` å­—æ®µ

**æ–¹æ³• B: ä½¿ç”¨ @userinfobot**
1. åœ¨ Telegram ä¸­æœç´¢ `@userinfobot`
2. å‘é€ `/start`
3. Bot ä¼šå›å¤ä½ çš„ Chat ID

#### 3. é…ç½® GitHub Secrets

åœ¨ä»“åº“ä¸­æ·»åŠ ä¸¤ä¸ª Secrets:
- `TELEGRAM_BOT_TOKEN`: ä½ çš„ Bot Token
- `TELEGRAM_CHAT_ID`: ä½ çš„ Chat ID

#### 4. æµ‹è¯•

æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ workflowï¼Œå¤±è´¥æ—¶ä¼šæ”¶åˆ° Telegram æ¨é€ã€‚

### è¿›é˜¶é…ç½®ï¼šåˆ›å»ºé€šçŸ¥ç¾¤ç»„

å¦‚æœæƒ³è®©å¤šäººæ¥æ”¶é€šçŸ¥ï¼š

1. åˆ›å»ºä¸€ä¸ª Telegram ç¾¤ç»„
2. æŠŠ Bot æ·»åŠ åˆ°ç¾¤ç»„
3. è·å–ç¾¤ç»„ Chat IDï¼ˆé€šå¸¸æ˜¯è´Ÿæ•°ï¼Œå¦‚ `-1001234567890`ï¼‰
4. æ›´æ–° `TELEGRAM_CHAT_ID` Secret

---

## æ–¹æ¡ˆ 4: Bark (iOS æ¨é€ï¼Œæç®€æ–¹æ¡ˆ) â­â­â­â­

### ä¼˜åŠ¿
- âœ… **è¶…çº§ç®€å•**ï¼Œåªéœ€ä¸€ä¸ª Key
- âœ… æ¨é€åˆ° iOS é€šçŸ¥ä¸­å¿ƒ
- âœ… æ”¯æŒè‡ªå®šä¹‰é“ƒå£°ã€è§’æ ‡

### é…ç½®æ­¥éª¤

#### 1. å®‰è£… Bark App
åœ¨ App Store æœç´¢å¹¶å®‰è£… [Bark](https://apps.apple.com/cn/app/bark/id1403753865)

#### 2. è·å– Bark Key
æ‰“å¼€ Appï¼Œå¤åˆ¶ä½ çš„æ¨é€ Keyï¼ˆå½¢å¦‚ `xxxxxxxxxx`ï¼‰

#### 3. é…ç½® GitHub Secret
æ·»åŠ  Secret: `BARK_KEY`

#### 4. æ·»åŠ  Workflow æ­¥éª¤

åœ¨ `daily-crawler.yml` ä¸­æ·»åŠ ï¼š

```yaml
- name: ğŸ“± Send Bark notification
  if: failure() && secrets.BARK_KEY != ''
  run: |
    curl -s "https://api.day.app/${{ secrets.BARK_KEY }}/X%20Crawler%20å¤±è´¥/$(TZ='Asia/Shanghai' date '+%Y-%m-%d%20%H:%M:%S')?group=crawler&sound=alarm&url=${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
```

### è‡ªå®šä¹‰é…ç½®

```bash
# åŸºç¡€æ¨é€
https://api.day.app/YOUR_KEY/æ ‡é¢˜/å†…å®¹

# å¸¦é“ƒå£°
?sound=alarm

# å¸¦åˆ†ç»„
?group=crawler

# å¸¦è·³è½¬é“¾æ¥
?url=https://example.com

# è‡ªåŠ¨ä¿å­˜
?automaticallyCopy=1&copy=å†…å®¹
```

**å¯ç”¨é“ƒå£°**: `alarm`, `anticipate`, `bell`, `birdsong`, `bloom`, `calypso`, `chime`, `choo`, `descent`, `electronic`, `fanfare`, `glass`, `gotosleep`, `healthnotification`, `horn`, `ladder`, `mailsent`, `minuet`, `multiwayinvitation`, `newmail`, `newsflash`, `noir`, `paymentsuccess`, `shake`, `sherwoodforest`, `silence`, `spell`, `suspense`, `telegraph`, `tiptoes`, `typewriters`, `update`

---

## æ–¹æ¡ˆ 5: ä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äºº â­â­â­â­

### ä¼˜åŠ¿
- âœ… ä¼ä¸šå†…éƒ¨é€šçŸ¥é¦–é€‰
- âœ… æ”¯æŒ Markdown
- âœ… å¯ @ ç‰¹å®šæˆå‘˜

### é…ç½®æ­¥éª¤

#### 1. åˆ›å»ºç¾¤æœºå™¨äºº

1. åœ¨ä¼ä¸šå¾®ä¿¡ä¸­åˆ›å»ºä¸€ä¸ªç¾¤
2. ç¾¤è®¾ç½® â†’ ç¾¤æœºå™¨äºº â†’ æ·»åŠ æœºå™¨äºº
3. è®¾ç½®æœºå™¨äººåç§°å’Œå¤´åƒ
4. å¤åˆ¶ **Webhook åœ°å€**

#### 2. é…ç½® GitHub Secret

æ·»åŠ  Secret: `WECHAT_WEBHOOK`ï¼ˆå®Œæ•´çš„ Webhook URLï¼‰

#### 3. Workflow å·²é›†æˆ

`daily-crawler.yml` å·²åŒ…å«ä¼ä¸šå¾®ä¿¡é€šçŸ¥ä»£ç ï¼Œé…ç½® Secret åè‡ªåŠ¨ç”Ÿæ•ˆã€‚

### è¿›é˜¶ï¼š@ ç‰¹å®šæˆå‘˜

```yaml
- name: ğŸ“¢ Send WeChat Work notification with mention
  run: |
    curl -s -X POST "${{ secrets.WECHAT_WEBHOOK }}" \
      -H "Content-Type: application/json" \
      -d '{
        "msgtype": "text",
        "text": {
          "content": "ğŸš¨ X Crawler è¿è¡Œå¤±è´¥\nè¯· @å¼ ä¸‰ å¤„ç†",
          "mentioned_list": ["zhangsan"],
          "mentioned_mobile_list": ["13800138000"]
        }
      }'
```

---

## æ–¹æ¡ˆ 6: é’‰é’‰ç¾¤æœºå™¨äºº â­â­â­â­

### é…ç½®æ­¥éª¤

#### 1. åˆ›å»ºç¾¤æœºå™¨äºº

1. é’‰é’‰ç¾¤è®¾ç½® â†’ æ™ºèƒ½ç¾¤åŠ©æ‰‹ â†’ æ·»åŠ æœºå™¨äºº â†’ è‡ªå®šä¹‰
2. è®¾ç½®æœºå™¨äººåç§°
3. **å®‰å…¨è®¾ç½®**é€‰æ‹© "è‡ªå®šä¹‰å…³é”®è¯"ï¼Œè¾“å…¥ï¼š`Crawler`
4. å¤åˆ¶ **Webhook åœ°å€**

#### 2. é…ç½® GitHub Secret

æ·»åŠ  Secret: `DINGTALK_WEBHOOK`

#### 3. æ·»åŠ  Workflow æ­¥éª¤

```yaml
- name: ğŸ“¢ Send DingTalk notification
  if: failure() && secrets.DINGTALK_WEBHOOK != ''
  run: |
    curl -s -X POST "${{ secrets.DINGTALK_WEBHOOK }}" \
      -H "Content-Type: application/json" \
      -d '{
        "msgtype": "markdown",
        "markdown": {
          "title": "X Crawler è¿è¡Œå¤±è´¥",
          "text": "## ğŸš¨ X Crawler è¿è¡Œå¤±è´¥\n\n- æ—¶é—´: '"$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"'\n- ä»“åº“: ${{ github.repository }}\n\n[æŸ¥çœ‹è¯¦æƒ…](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})"
        }
      }'
```

### è¿›é˜¶ï¼š@ æ‰€æœ‰äºº

```json
{
  "msgtype": "text",
  "text": {
    "content": "ğŸš¨ X Crawler è¿è¡Œå¤±è´¥ï¼Œè¯·åŠæ—¶å¤„ç†"
  },
  "at": {
    "isAtAll": true
  }
}
```

---

## æ–¹æ¡ˆ 7: Discord Webhook â­â­â­

### é…ç½®æ­¥éª¤

#### 1. åˆ›å»º Webhook

1. Discord æœåŠ¡å™¨è®¾ç½® â†’ æ•´åˆ â†’ Webhooks
2. ç‚¹å‡» "æ–°å»º Webhook"
3. è®¾ç½®åç§°ã€é€‰æ‹©é¢‘é“
4. å¤åˆ¶ **Webhook URL**

#### 2. é…ç½® GitHub Secret

æ·»åŠ  Secret: `DISCORD_WEBHOOK`

#### 3. æ·»åŠ  Workflow æ­¥éª¤

æŸ¥çœ‹ `notifications.yml` ä¸­çš„ Discord ç¤ºä¾‹ã€‚

---

## ğŸ¯ æ¨èç»„åˆæ–¹æ¡ˆ

### ä¸ªäººå¼€å‘è€…
```
GitHub Issue (å·²å¯ç”¨) + Telegram
```
- Issue ç”¨äºé—®é¢˜è·Ÿè¸ª
- Telegram ç”¨äºå³æ—¶é€šçŸ¥

### å›¢é˜Ÿåä½œ
```
GitHub Issue + ä¼ä¸šå¾®ä¿¡/é’‰é’‰
```
- Issue è®°å½•å†å²
- ä¼ä¸šé€šè®¯å·¥å…·é€šçŸ¥å›¢é˜Ÿ

### iOS ç”¨æˆ·
```
GitHub Issue + Bark
```
- æœ€ç®€å•çš„æ¨é€æ–¹æ¡ˆ

---

## ğŸ“ é…ç½®æ£€æŸ¥æ¸…å•

å®Œæˆé…ç½®åï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æµ‹è¯•ï¼š

- [ ] å·²æ·»åŠ å¿…è¦çš„ GitHub Secrets
- [ ] å·²æ›´æ–° `daily-crawler.yml` æ·»åŠ é€šçŸ¥æ­¥éª¤
- [ ] æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å¤±è´¥çš„ workflow æµ‹è¯•é€šçŸ¥
  ```bash
  # åœ¨ workflow ä¸­ä¸´æ—¶æ·»åŠ ä¸€ä¸ªå¤±è´¥æ­¥éª¤
  - run: exit 1
  ```
- [ ] ç¡®è®¤æ”¶åˆ°é€šçŸ¥
- [ ] ç§»é™¤æµ‹è¯•å¤±è´¥æ­¥éª¤

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### Telegram æ²¡æ”¶åˆ°é€šçŸ¥

**æ£€æŸ¥é¡¹:**
1. Bot Token å’Œ Chat ID æ˜¯å¦æ­£ç¡®
2. æ˜¯å¦å‘ Bot å‘é€è¿‡è‡³å°‘ä¸€æ¡æ¶ˆæ¯
3. Bot æ˜¯å¦è¢« Telegram å°ç¦ï¼ˆå¾ˆå°‘è§ï¼‰

**æµ‹è¯•å‘½ä»¤:**
```bash
# æ‰‹åŠ¨æµ‹è¯•æ¨é€
curl -X POST "https://api.telegram.org/bot<YOUR_TOKEN>/sendMessage" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "<YOUR_CHAT_ID>",
    "text": "æµ‹è¯•æ¶ˆæ¯"
  }'
```

### ä¼ä¸šå¾®ä¿¡/é’‰é’‰æ²¡æ”¶åˆ°

**æ£€æŸ¥é¡¹:**
1. Webhook URL æ˜¯å¦å®Œæ•´
2. æ˜¯å¦è®¾ç½®äº†å®‰å…¨å…³é”®è¯ï¼ˆé’‰é’‰ï¼‰
3. æ¶ˆæ¯å†…å®¹æ˜¯å¦åŒ…å«å…³é”®è¯

### GitHub Issue æ²¡åˆ›å»º

**æ£€æŸ¥é¡¹:**
1. Actions æƒé™æ˜¯å¦å¯ç”¨å†™æƒé™
2. æ˜¯å¦æœ‰ `github-script` action æŠ¥é”™

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é¿å…é€šçŸ¥ç–²åŠ³

**åªåœ¨é‡è¦å¤±è´¥æ—¶é€šçŸ¥:**
```yaml
- name: ğŸš¨ Notify only on critical failures
  if: failure() && contains(github.event.head_commit.message, '[critical]')
```

### 2. åˆ†çº§é€šçŸ¥

```yaml
# è¿ç»­å¤±è´¥ 3 æ¬¡æ‰é€šçŸ¥
- name: Check failure count
  id: check
  run: |
    FAIL_COUNT=$(gh api repos/${{ github.repository }}/actions/runs --jq '[.workflow_runs[] | select(.conclusion=="failure")] | length')
    if [ $FAIL_COUNT -ge 3 ]; then
      echo "notify=true" >> $GITHUB_OUTPUT
    fi

- name: Send notification
  if: steps.check.outputs.notify == 'true'
  run: # å‘é€é€šçŸ¥
```

### 3. æˆåŠŸæ¢å¤é€šçŸ¥

```yaml
- name: âœ… Notify on recovery
  if: success() && github.event.before != ''
  run: |
    # æ£€æŸ¥ä¸Šä¸€æ¬¡è¿è¡Œæ˜¯å¦å¤±è´¥
    PREV_STATUS=$(gh api repos/${{ github.repository }}/actions/runs/${{ github.event.before }} --jq .conclusion)
    if [ "$PREV_STATUS" = "failure" ]; then
      # å‘é€æ¢å¤é€šçŸ¥
    fi
```

---

## ğŸ“š æ›´å¤šèµ„æº

- [Telegram Bot API æ–‡æ¡£](https://core.telegram.org/bots/api)
- [ä¼ä¸šå¾®ä¿¡æœºå™¨äººæ–‡æ¡£](https://developer.work.weixin.qq.com/document/path/91770)
- [é’‰é’‰æœºå™¨äººæ–‡æ¡£](https://open.dingtalk.com/document/robots/custom-robot-access)
- [Bark ä½¿ç”¨æ–‡æ¡£](https://github.com/Finb/Bark)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)

---

éœ€è¦å¸®åŠ©ï¼Ÿåœ¨ Issues ä¸­æé—®ï¼Œæˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚
