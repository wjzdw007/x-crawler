# X爬虫项目设计文档

## 项目概述
基于Python实现的X(Twitter)推荐时间线爬虫，每日采集帖子并通过LLM生成总结报告。

## 技术方案

### 核心思路
1. **两阶段开发**：先用Playwright分析接口，后用纯HTTP实现
2. **简化存储**：登录态用JSON文件，帖子数据保存为JSON
3. **重点解决已知问题**：转推、嵌套转推、媒体文件获取

### 项目结构
```
x_crawler/
├── cookies.json          # 登录态存储
├── data/                # 每日JSON数据
├── reports/             # 生成的日报
├── docs/                # 文档和讨论记录
│   ├── design.md        # 设计方案和架构
│   ├── api_analysis.md  # API接口分析结果
│   ├── discussions.md   # 讨论记录和决策
│   └── todo.md          # 任务清单和进度
├── tools/               # 探索和调试工具
│   ├── analyzer.py      # Playwright分析脚本
│   ├── test_login.py    # 测试登录态有效性
│   ├── api_explorer.py  # API接口探索工具
│   └── debug_helper.py  # 调试辅助工具
├── crawler.py           # 主爬虫逻辑
├── summarizer.py        # LLM总结模块
└── scheduler.py         # 定时任务
```

## 已知难点问题

### 1. 转推(Retweet)数据问题
- **问题**：转帖的原帖获取不到
- **解决方案**：深入分析retweet数据结构，找到原帖数据的正确获取路径

### 2. 嵌套转推问题
- **问题**：A转了B的帖子，B的帖子又是转的C的帖子
- **解决方案**：分析嵌套数据结构，实现递归解析逻辑

### 3. 媒体文件获取问题
- **问题**：获取不到图片视频地址
- **解决方案**：分析media字段结构，找到高质量媒体文件URL

### 4. 数据完整性问题
- **问题**：数据错误、不完整
- **解决方案**：实现数据验证和错误检测机制

## 开发阶段

### 阶段1: 逆向分析 (使用Playwright)
- 深度分析X推荐时间线API接口
- 重点研究转推、嵌套转推、媒体文件的数据结构
- 测试登录态cookie的使用和维护

### 阶段2: 纯HTTP实现
- 基于分析结果实现HTTP客户端
- 实现数据验证和错误处理
- 完善的数据结构解析

### 阶段3: LLM总结和调度
- LLM接口集成
- 报告生成
- 定时任务调度

## 技术选型
- **语言**：Python
- **分析工具**：Playwright (仅分析阶段)
- **HTTP库**：requests
- **数据存储**：JSON文件
- **LLM**：待定 (Claude/GPT等)
- **调度**：Python脚本 + crontab

## 成功标准
1. 能够稳定获取推荐时间线数据
2. 正确处理转推和嵌套转推
3. 完整获取文本、图片、视频等内容
4. 生成高质量的日报总结
5. 系统稳定运行，错误率低